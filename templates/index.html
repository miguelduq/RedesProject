<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Would You Rather - Python WebSocket</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    /* começa sempre escondido (mantendo para não quebrar seu JS) */
    #questionSection { display: none; }
    #startGameSection { display: none; }
    #playersSection { display: none; }
    #waitingScreen { display: none; }
    #endRoundSection { display: none; }
  </style>
</head>

<body class="min-h-screen flex items-center justify-center bg-gradient-to-br from-indigo-900 via-purple-900 to-slate-900 text-slate-100 p-4">

  <div class="w-full max-w-3xl bg-white/10 backdrop-blur-lg rounded-3xl shadow-2xl p-8 border border-white/10">
    
    <!-- Título -->
    <header class="text-center mb-8">
      <h1 class="text-3xl md:text-4xl font-extrabold tracking-tight mb-2">
        Would You Rather
      </h1>
      <p class="text-sm md:text-base text-slate-200/80">
        Demo com Flask-SocketIO • Crie uma sala, compartilhe o código e joguem juntos em tempo real.
      </p>
    </header>

    <div class="grid gap-8 md:grid-cols-2">

      <!-- Criar Sala (Host) -->
      <div id="createRoomSection" class="bg-slate-900/40 rounded-2xl p-5 border border-slate-700/60 shadow-lg shadow-black/20">
        <h2 class="text-lg font-semibold mb-3 flex items-center gap-2">
          <span class="inline-flex h-8 w-8 items-center justify-center rounded-full bg-emerald-500/20 text-emerald-300 text-sm font-bold">
            1
          </span>
          Criar sala (Host)
        </h2>

        <button
          id="btnCreateRoom"
          class="w-full mt-2 px-4 py-3 rounded-xl bg-emerald-500 hover:bg-emerald-600 active:bg-emerald-700 transition font-semibold text-sm md:text-base shadow-lg shadow-emerald-500/30"
        >
          Criar Sala (Host)
        </button>

        <p id="roomInfo" class="mt-3 text-sm text-emerald-200/90 break-words"></p>
      </div>

      
      <!-- Entrar em sala -->
      <div id="joinRoomSection" class="bg-slate-900/40 rounded-2xl p-5 border border-slate-700/60 shadow-lg shadow-black/20">
        <h2 class="text-lg font-semibold mb-3 flex items-center gap-2">
          <span class="inline-flex h-8 w-8 items-center justify-center rounded-full bg-sky-500/20 text-sky-300 text-sm font-bold">
            2
          </span>
          Entrar em uma sala
        </h2>

        <div class="space-y-3">
          <input
            id="roomCodeInput"
            placeholder="Código da sala"
            class="w-full px-3 py-2 rounded-xl bg-slate-800/80 border border-slate-600 text-sm md:text-base 
                   focus:outline-none focus:ring-2 focus:ring-sky-500 placeholder:text-slate-400"
          />

          <input
            id="playerNameInput"
            placeholder="Seu nome"
            class="w-full px-3 py-2 rounded-xl bg-slate-800/80 border border-slate-600 text-sm md:text-base
                   focus:outline-none focus:ring-2 focus:ring-sky-500 placeholder:text-slate-400"
          />

          <button
            id="btnJoinRoom"
            class="w-full mt-1 px-4 py-3 rounded-xl bg-sky-500 hover:bg-sky-600 active:bg-sky-700 transition font-semibold text-sm md:text-base shadow-lg shadow-sky-500/30"
          >
            Entrar
          </button>
        </div>
      </div>

    </div>


    <!-- Seções dinâmicas da partida -->

    <!-- Controles do Host -->
    <div id="startGameSection" class="bg-slate-900/40 rounded-2xl p-5 mt-8 border border-slate-700/60">
      <h2 class="text-lg font-semibold mb-3">Controle do Host</h2>
      <button
        id="btnStartGame"
        class="w-full px-4 py-3 rounded-xl bg-amber-500 hover:bg-amber-600 active:bg-amber-700 transition font-semibold shadow-lg shadow-amber-500/30"
      >
        Iniciar jogo
      </button>
    </div>

    <div id="endRoundSection" class="bg-slate-900/40 rounded-2xl p-5 mt-6 border border-slate-700/60">
      <h2 class="text-lg font-semibold mb-3">Rodada atual</h2>
      <button
        id="btnEndRound"
        class="w-full px-4 py-3 rounded-xl bg-rose-500 hover:bg-rose-600 active:bg-rose-700 transition font-semibold shadow-lg shadow-rose-500/30"
      >
        Finalizar rodada
      </button>
    </div>

    <!-- Jogadores -->
    <div id="playersSection" class="bg-slate-900/40 rounded-2xl p-5 mt-6 border border-slate-700/60">
      <h3 class="text-lg font-semibold mb-3">Jogadores na sala</h3>
      <pre id="playersList"
           class="text-sm md:text-base bg-slate-950/40 rounded-xl p-3 max-h-40 overflow-y-auto whitespace-pre-wrap">
      </pre>
    </div>

    <!-- Tela de espera -->
    <div id="waitingScreen" class="bg-slate-900/40 rounded-2xl p-5 mt-8 border border-dashed border-slate-600 text-center">
      <h2 class="text-lg font-semibold mb-2">Aguardando o Host iniciar a partida...</h2>
      <p class="text-sm text-slate-300">Assim que o Host começar, a pergunta aparecerá aqui.</p>
    </div>

    <!-- Mensagens -->
    <p id="messages" class="mt-6 text-sm text-rose-300 min-h-[1.5rem]"></p>
  </div>

  <!-- Pergunta -->
    <div id="questionSection" class="hidden">

      <div class="fixed inset-0 grid grid-cols-1 md:grid-cols-2">

        <!-- OPÇÃO A -->
        <button
          id="btnChooseA"
          class="flex flex-col items-center justify-center w-full h-full
                bg-gradient-to-br from-red-500 to-pink-600
                hover:brightness-110 transition text-white text-center p-4"
        >
          <p class="text-2xl md:text-4xl font-bold leading-tight px-6">
            <span id="optionAText">Opção A</span>
          </p>
        </button>

        <!-- OPÇÃO B -->
        <button
          id="btnChooseB"
          class="flex flex-col items-center justify-center w-full h-full
                bg-gradient-to-br from-blue-500 to-sky-600 
                hover:brightness-110 transition text-white text-center p-4"
        >
          <p class="text-2xl md:text-4xl font-bold leading-tight px-6">
            <span id="optionBText">Opção B</span>
          </p>
        </button>

      </div>

      <!-- PERGUNTA CENTRAL (por cima) -->
      <div class="fixed top-10 left-1/2 -translate-x-1/2 text-center text-white drop-shadow-lg">
        <h2 class="text-xl md:text-2xl font-semibold"></h2>
        <p id="questionText" class="text-sm md:text-xl font-medium max-w-2xl mt-2"></p>
      </div>

    </div>

  <!-- Socket.IO -->
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

  <script>
    const socket = io(); // conecta no mesmo host/porta do Flask

    let currentRoomCode = null;
    let isHost = false; // aqui: por padrão ninguém é host

    // lista jogadores
    const playersSection = document.getElementById("playersSection");
    const playersList     = document.getElementById("playersList");

    // Questions Section
    const questionSection = document.getElementById("questionSection");
    const questionText    = document.getElementById("questionText");
    const btnChooseA      = document.getElementById("btnChooseA");
    const btnChooseB      = document.getElementById("btnChooseB");
    // fullscreen texts
    const optionAText = document.getElementById("optionAText");
    const optionBText = document.getElementById("optionBText");

    // waiting screen 
    const waitingScreen = document.getElementById("waitingScreen");

    // create Room Section
    const btnCreateRoom   = document.getElementById("btnCreateRoom");
    const createRoomSection = document.getElementById("createRoomSection");
    const roomInfo        = document.getElementById("roomInfo");

    // entrar na sala
    const joinRoomSection = document.getElementById("joinRoomSection");
    const roomCodeInput   = document.getElementById("roomCodeInput");
    const playerNameInput = document.getElementById("playerNameInput");
    const btnJoinRoom     = document.getElementById("btnJoinRoom");

    // iniciar jogo
    const startGameSection = document.getElementById("startGameSection");
    const btnStartGame    = document.getElementById("btnStartGame");

    // finalizar rodada 
    const endRoundSection = document.getElementById("endRoundSection")
    const btnEndRound = document.getElementById("btnEndRound")

    // messages 
    const messages        = document.getElementById("messages");
    



    // criar sala (host)
    btnCreateRoom.onclick = () => {
      socket.emit("createRoom");
    };

    // sala criada
    socket.on("roomCreated", ({ roomCode }) => {
      currentRoomCode = roomCode;
      isHost = true; // você é o host dessa sala

      roomInfo.textContent = "Você é o host da sala: " + roomCode;
      messages.textContent = "";

      // host não precisa mais ver a parte de entrar em sala
      joinRoomSection.style.display = "none";

      // mostrar o botao de inciar 
      startGameSection.style.display = "block";

      // se quiser, também pode desabilitar o botão
      btnCreateRoom.disabled = true;
    });




    // entrar na sala
    btnJoinRoom.onclick = () => {
      const roomCode   = roomCodeInput.value.trim();
      const playerName = playerNameInput.value.trim();

      if (!roomCode || !playerName) {
        messages.textContent = "Preencha o código da sala e seu nome.";
        return;
      }

      currentRoomCode = roomCode;
      isHost = false; // quem entra é jogador, não host
      socket.emit("joinRoom", { roomCode, playerName });

      // Esconde opções de criar sala
      createRoomSection.style.display = "none";

      // Esconde a área de entrar em sala
      joinRoomSection.style.display = "none";

      // MOSTRA tela de aguardo
      waitingScreen.style.display = "block";
    };


    // atualização de jogadores
    socket.on("playersUpdate", ({ players }) => {

      playersSection.style.display = "block";

      const nomes = Object.values(players);

      if (nomes.length === 0) {
        playersList.textContent = "Nenhum jogador conectado ainda.";
      } else {
        playersList.textContent = nomes.map(n => "- " + n).join("\n");
      }
    });



    // erros
    socket.on("errorMessage", (msg) => {
      messages.textContent = msg;
    });




    // iniciar jogo (host)
    btnStartGame.onclick = () => {
      if (!currentRoomCode) {
        messages.textContent = "Nenhuma sala ativa.";
        return;
      }
      socket.emit("startGame", { roomCode: currentRoomCode });
    };

    socket.on("gameStarted", () => {
      messages.textContent = "Jogo iniciado!";

      // Esconde controles antigos
      startGameSection.style.display = "none";
      waitingScreen.style.display    = "none";
      playersSection.style.display   = "none";

      // reativa botões de resposta (para os jogadores)
      btnChooseA.disabled = false;
      btnChooseB.disabled = false;

      if (isHost) {
        // HOST: não vê a tela fullscreen para não cobrir o botão de finalizar
        questionSection.style.display = "none";

        // mostra o botão de finalizar rodada
        endRoundSection.style.display = "block";

      } else {
        // JOGADOR: vê a tela fullscreen
        questionSection.style.display = "block";
        endRoundSection.style.display = "none";

        // garante que os botões apareçam (fullscreen)
        btnChooseA.style.display = "block";
        btnChooseB.style.display = "block";
      }

      // envia a pergunta automaticamente quando o round começa (só o host)
      if (isHost) {
        socket.emit("sendQuestion", { roomCode: currentRoomCode });
      }
    });

    btnEndRound.onclick = () => {
      if (!isHost) return; // só o host finaliza

      messages.textContent = "Round Finalizado";
      socket.emit("endRound", { roomCode: currentRoomCode });
    };
    
    socket.on("roundResults", ({ votosA, votosB }) => {
      messages.textContent = `Resultados da rodada – A: ${votosA} voto(s) | B: ${votosB} voto(s)`;

      // mostra o botão de iniciar próxima partida/rodada só para o host
      if (isHost) {
        startGameSection.style.display = "block";
      }

      // esconde o botao de finalizar
      endRoundSection.style.display = "none";

      questionSection.style.display = "none";
    });


    socket.on("newQuestion", ({ optionA, optionB }) => {

      // Texto da pergunta geral (se quiser exibir no topo)
      questionText.textContent = "Você prefere";

      // Preenche os textos das metades
      optionAText.textContent = optionA;
      optionBText.textContent = optionB;

      // Limpa mensagens antigas
      messages.textContent = "";
    });

    // resposta do jogador
    btnChooseA.onclick = () => {
      if (currentRoomCode) {
        socket.emit("submitAnswer", { roomCode: currentRoomCode, choice: "A" });
        // so pode votar uma vez
        btnChooseA.disabled = true;
        btnChooseB.disabled = true;
      }
    };

    btnChooseB.onclick = () => {
      if (currentRoomCode) {
        socket.emit("submitAnswer", { roomCode: currentRoomCode, choice: "B" });
        // so pode votar uma vez
        btnChooseA.disabled = true;
        btnChooseB.disabled = true;
      }
    };

    socket.on("answerReceived", ({ choice }) => {
      messages.textContent = "Resposta enviada: " + choice;
    });
  </script>
</body>
</html>
